<!-- Se incluye el layout del header -->
<%- include('layouts/header') %>
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Renovaciones</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="/sistema">Home</a>
            </li>
            <li class="breadcrumb-item">
                <a>Renovaciones</a>
            </li>
            <li class="breadcrumb-item active">
                <strong>Consulta de renovaciones</strong>
            </li>
        </ol>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>Renovaciones</h5>
                </div>
                <div class="ibox-content">
                    <form method="POST" action="/sistema/consult-renewal">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="ibox">
                                    <div class="form-control">
                                        <div class="form-group row"><label class="col-sm-3 col-form-label">Póliza No.</label>
                                            <div class="col-sm-9">
                                                <input 
                                                    type="text"
                                                    name="numero_poliza"
                                                    id="numero_poliza"
                                                    placeholder="Número de Póliza" 
                                                    class="form-control"
                                                    oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);"
                                                >
                                            </div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <div class="form-group row"><label class="col-sm-3 col-form-label">Aseguradora</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" name="nombre_aseguradora">
                                                    <option value="">Seleccione</option>
                                                    <% insurers.forEach((insurer) => { %>
                                                        <option value="<%= insurer.nombre_aseguradora %>"><%= insurer.nombre_aseguradora %></option>
                                                    <% }); %>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <div class="form-group row"><label class="col-sm-3 col-form-label">Ramo</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" name="ramo_poliza">
                                                    <option value="">Seleccione</option>
                                                    <option value="SALUD">SALUD</option>
                                                    <option value="FIANZA">FIANZA</option>
                                                    <option value="AUTOMÓVIL">AUTOMÓVIL</option>
                                                    <option value="PATRIMONIAL">PATRIMONIAL</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <div class="form-group row"><label class="col-sm-3 col-form-label">Fecha</label>
                                            <div class="col-sm-9">
                                                <input 
                                                    type="date"
                                                    name="fecha_poliza"
                                                    id="fecha_poliza"
                                                    class="form-control"
                                                >
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="ibox">
                                    <div class="form-control">
                                        <div class="form-group row"><label class="col-sm-3 col-form-label">Nombre del Cliente</label>
                                            <div class="col-sm-9">
                                                <input 
                                                    type="text"
                                                    name="nombre_asegurado"
                                                    id="nombre_asegurado" 
                                                    placeholder="Nombre del Cliente" 
                                                    class="form-control"
                                                    oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);"
                                                >
                                            </div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <div class="form-group row"><label class="col-sm-3 col-form-label">Cédula/Rif</label>
                                            <div class="col-sm-9 field">
                                                <div class="numeral-selector selector">
                                                    <div class="select-box-wrapper">
                                                        <select name="tipo_id_rif_asegurado" id="select_box">
                                                            <option value="V">V</option>
                                                            <option value="E">E</option>
                                                            <option value="J">J</option>
                                                            <option value="G">G</option>
                                                            <option value="I">I</option>
                                                            <option value="F">F</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <input 
                                                    type="text"
                                                    name="id_rif_asegurado"
                                                    id="id_rif_asegurado"
                                                    onkeyup="pasarNombreAsegurado();"
                                                    placeholder="Cédula/Rif" 
                                                    class="form-control input-numeral"
                                                >
                                            </div>
                                        </div>
                                        <div class="hr-line-dashed"></div>
                                        <div class="form-group row"><label class="col-sm-3 col-form-label">Tipo de Suscripción</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" name="tipo_poliza">
                                                    <option value="">Seleccione</option>
                                                    <option value="INDIVIDUAL">INDIVIDUAL</option>
                                                    <option value="COLECTIVO">COLECTIVO</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group row">
                            <div class="col-sm-12 col-sm-offset-2">
                                <div class="card-body d-flex">
                                    <button class="btn btn-primary btn-sm ml-auto" type="submit">Consultar</button>
                                </div>
                            </div>
                        </div>
                    </form>
                    <% if (typeof(data) !== 'undefined') { %>
                        <div class="table-responsive">
                            <table 
                                class="table table-striped table-bordered table-hover"
                                id="tablaRenovaciones" 
                            >
                            <thead>
                            <tr>
                                <th>Número Póliza</th>
                                <th>Tomador</th>
                                <th>Ramo</th>
                                <th>Fecha desde</th>
                                <th>Fecha hasta</th>
                                <th>Moneda</th>
                                <th>Prima Neta</th>
                                <th>Estatus</th>
                                <th>Tipo Póliza</th>
                                <th>Aseguradora</th>
                                <th>Nombre/Razón</th>
                                <th>Tipo Cédula/Rif</th>
                                <th>Cédula/Rif</th>
                            </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                            <tfoot>
                            <tr>
                                <th>Número Póliza</th>
                                <th>Tomador</th>
                                <th>Ramo</th>
                                <th>Fecha desde</th>
                                <th>Fecha hasta</th>
                                <th>Moneda</th>
                                <th>Prima Neta</th>
                                <th>Estatus</th>
                                <th>Tipo Póliza</th>
                                <th>Aseguradora</th>
                                <th>Nombre/Razón</th>
                                <th>Tipo Cédula/Rif</th>
                                <th>Cédula/Rif</th>
                            </tr>
                            </tfoot>
                            </table>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>
</br>
</br>
</br>
<div class="footer">
    
</div>
</div>
</div>

<!-- Mainly scripts -->
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Flot -->
<script src="/js/plugins/flot/jquery.flot.js"></script>
<script src="/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
<script src="/js/plugins/flot/jquery.flot.spline.js"></script>
<script src="/js/plugins/flot/jquery.flot.resize.js"></script>
<script src="/js/plugins/flot/jquery.flot.pie.js"></script>

<!-- Peity -->
<script src="/js/plugins/peity/jquery.peity.min.js"></script>
<script src="/js/demo/peity-demo.js"></script>

<!-- Custom and plugin javascript -->
<script src="/js/inspinia.js"></script>
<script src="/js/plugins/pace/pace.min.js"></script>

<!-- jQuery UI -->
<script src="/js/plugins/jquery-ui/jquery-ui.min.js"></script>

<!-- GITTER -->
<script src="/js/plugins/gritter/jquery.gritter.min.js"></script>

<!-- Sparkline -->
<script src="/js/plugins/sparkline/jquery.sparkline.min.js"></script>

<!-- Sparkline demo data  -->
<script src="/js/demo/sparkline-demo.js"></script>

<!-- ChartJS-->
<script src="/js/plugins/chartJs/Chart.min.js"></script>

<!-- Toastr -->
<script src="/js/plugins/toastr/toastr.min.js"></script>

<!-- DataTables -->
<script src="/js/plugins/dataTables/datatables.min.js"></script>
<script src="/js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="/js/cleave-js/cleave.min.js"></script>

<!-- Page-Level Scripts -->

<% if (typeof(data) !== 'undefined') { %>
    <script>
        var lista = <%- JSON.stringify(data) %>;
        var tablaRenovacion = null;
        $(document).ready(function(){
            tablaRenovacion = $('#tablaRenovaciones').DataTable({
                pageLength: 25,
                responsive: true,
                dom: '<"html5buttons"B>lTfgitp',
                processing: true,
                serverSide: false,
                columns: [
                    {"data": "numero_poliza"},
                    {"data": "nombre_tomador_poliza"},
                    {"data": "tipo_individual_poliza"},
                    {"data": "fecha_desde_poliza"},
                    {"data": "fecha_hasta_poliza"},
                    {"data": "tipo_moneda_poliza"},
                    {"data": "prima_neta_poliza"},
                    {"data": "estatus_poliza"},
                    {"data": "tipo_poliza"},
                    {"data": "nombre_aseguradora"},
                    {"data": "nombre_completo_razon_social_asegurado"},
                    {"data": "tipo_cedula_rif_asegurado"},
                    {"data": "cedula_rif_asegurado"},
                ],
                buttons: [
                    {
                        extend: 'print',
                        customize: function (win){
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                        },
                        text: 'Imprimir'
                    }
                ],
                language: {
                    "decimal": "",
                    "emptyTable": "No hay información",
                    "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                    "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                    "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                    "infoPostFix": "",
                    "thousands": ".",
                    "lengthMenu": "Mostrar _MENU_ Entradas",
                    "loadingRecords": "Cargando...",
                    "processing": "Procesando...",
                    "search": "Buscar:",
                    "zeroRecords": "Sin resultados encontrados",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    }
                }
            });
            tablaRenovacion.rows.add(lista);
            tablaRenovacion.draw();
        });
    </script>
<% } %>

<script>
    if (($('#select_box').val() === 'V') || ($('#select_box').val() === 'E')) {
        var cleaveNumeral = new Cleave('.input-numeral', {
            numeral: true,
            numeralDecimalMark: ',',
            delimiter: '.',
            stripLeadingZeroes: false
        });
    } else {
        var cleaveNumeral = new Cleave('.input-numeral', {
            numeral: true,
            numeralDecimalMark: '!',
            delimiter: '',
            stripLeadingZeroes: false
        });
    }

    $('#select_box').change(function(){
        if ((this.value === 'V') || (this.value === 'E')) {
            var cleaveNumeral = new Cleave('.input-numeral', {
                numeral: true,
                numeralDecimalMark: ',',
                delimiter: '.',
                stripLeadingZeroes: false
            });
            cleaveNumeral.setRawValue('');
        } else {
            var cleaveNumeral = new Cleave('.input-numeral', {
                numeral: true,
                numeralDecimalMark: '!',
                delimiter: '',
                stripLeadingZeroes: false,
            });
            cleaveNumeral.setRawValue('');
        }
    });
</script>

</body>

</html>