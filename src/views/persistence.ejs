<!-- Se incluye el layout del header -->
<%- include('layouts/header') %>
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Reportes</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="/sistema">Home</a>
            </li>
            <li class="breadcrumb-item">
                <a>Reportes</a>
            </li>
            <li class="breadcrumb-item active">
                <strong>Consulta de Persistencia</strong>
            </li>
        </ol>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title">
                    <h5>Persistencia</h5>
                </div>
                <div class="ibox-content">
                    <form method="POST" action="/sistema/persistence">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="form-group">
                                    <div class="form-group row"><label class="col-sm-3 col-form-label">Fecha Desde Inicio Póliza</label>
                                        <div class="col-sm-9">
                                            <input 
                                                type="date"
                                                name="fecha_inicio"
                                                id="fecha_inicio"
                                                class="form-control"
                                                required
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="form-group">
                                    <div class="form-group row"><label class="col-sm-3 col-form-label">Fecha Hasta Inicio Póliza</label>
                                        <div class="col-sm-9">
                                            <input 
                                                type="date"
                                                name="fecha_final"
                                                id="fecha_final"
                                                class="form-control"
                                                required
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="form-group">
                                    <div class="form-group row"><label class="col-form-label col-sm-1half">Tipo de Moneda</label>
                                        <div class="col-sm-10half">
                                            <select class="form-control" name="tipo_moneda" id="tipo_moneda" required>
                                                <option value="">Seleccione *</option>
                                                <option value="BOLÍVAR">BOLÍVAR</option>
                                                <option value="DÓLAR">DÓLAR</option>
                                                <option value="EUROS">EUROS</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-12 col-sm-offset-2">
                                <div class="card-body d-flex">
                                    <button class="btn btn-primary btn-sm ml-auto" type="submit">Consultar</button>
                                </div>
                            </div>
                        </div>
                    </form>
                    <% if (typeof(data) !== 'undefined') { %>
                        <div class="table-responsive">
                            <table 
                                class="table table-striped table-bordered table-hover"
                                id="tablaPersistencias" 
                            >
                            <thead>
                            <tr>
                                <th>Tipo Póliza</th>
                                <th>Pólizas Renovadas</th>
                                <th>Pólizas no Renovadas</th>
                                <th>Total Base</th>
                            </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                            <tfoot>
                            <tr>
                                <th>Tipo Póliza</th>
                                <th>Pólizas Renovadas</th>
                                <th>Pólizas no Renovadas</th>
                                <th>Total Base</th>
                            </tr>
                            </tfoot>
                            </table>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div> 
</div>
</br>
</br>
</br>
<div class="footer">
    
</div>
</div>
</div>

<!-- Mainly scripts -->
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Flot -->
<script src="/js/plugins/flot/jquery.flot.js"></script>
<script src="/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
<script src="/js/plugins/flot/jquery.flot.spline.js"></script>
<script src="/js/plugins/flot/jquery.flot.resize.js"></script>
<script src="/js/plugins/flot/jquery.flot.pie.js"></script>

<!-- Peity -->
<script src="/js/plugins/peity/jquery.peity.min.js"></script>
<script src="/js/demo/peity-demo.js"></script>

<!-- Custom and plugin javascript -->
<script src="/js/inspinia.js"></script>
<script src="/js/plugins/pace/pace.min.js"></script>

<!-- jQuery UI -->
<script src="/js/plugins/jquery-ui/jquery-ui.min.js"></script>

<!-- GITTER -->
<script src="/js/plugins/gritter/jquery.gritter.min.js"></script>

<!-- Sparkline -->
<script src="/js/plugins/sparkline/jquery.sparkline.min.js"></script>

<!-- Sparkline demo data  -->
<script src="/js/demo/sparkline-demo.js"></script>

<!-- ChartJS-->
<script src="/js/plugins/chartJs/Chart.min.js"></script>

<!-- Toastr -->
<script src="/js/plugins/toastr/toastr.min.js"></script>

<!-- DataTables -->
<script src="/js/plugins/dataTables/datatables.min.js"></script>
<script src="/js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Page-Level Scripts -->
<% if (typeof(data) !== 'undefined') { %>
    <script>
        function toDataURL(src, callback){
            var image = new Image();
            image.crossOrigin = 'Anonymous';
            image.onload = function(){
                var canvas = document.createElement('canvas');
                var context = canvas.getContext('2d');
                canvas.height = this.naturalHeight;
                canvas.width = this.naturalWidth;
                context.drawImage(this, 0, 0);
                var dataURL = canvas.toDataURL('image/png');
                callback(dataURL);
            };
            image.src = src;
        }   
        toDataURL('/img/LOGOTIPO_VPRINCIPAL_ATINA.png', function(dataURL){
            localStorage.setItem("formDataImageAtina", dataURL) 
        });
    </script>
    <script>
        var lista = <%- JSON.stringify(data) %>;
        var tablaPersistencia = null;
        $(document).ready(function(){
            tablaPersistencia = $('#tablaPersistencias').DataTable({
                pageLength: 25,
                responsive: true,
                dom: '<"html5buttons"B>lTfgitp',
                processing: true,
                serverSide: false,
                columns: [
                    {"data": "tipo_poliza"},
                    {"data": "poliza_renovada"},
                    {"data": "poliza_no_renovada"},
                    {"data": "total_base"}
                ],
                buttons: [
                    {extend: 'excel', title: 'Persistencia'},
                    {
                        extend: 'pdfHtml5',
                        title: 'Persistencia',
                        customize: function ( doc ) {
                            doc.content.splice( 1, 0, {
                                margin: [ 0, 0, 0, 12 ],
                                alignment: 'left',
                                image: localStorage.formDataImageAtina,
                                width: 80,
                                height: 30
                            } );
                        }
                    },
                    {
                        extend: 'print',
                        customize: function (win){
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                        },
                        text: 'Imprimir'
                    }
                ],
                language: {
                    "decimal": "",
                    "emptyTable": "No hay información",
                    "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                    "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                    "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                    "infoPostFix": "",
                    "thousands": ".",
                    "lengthMenu": "Mostrar _MENU_ Entradas",
                    "loadingRecords": "Cargando...",
                    "processing": "Procesando...",
                    "search": "Buscar:",
                    "zeroRecords": "Sin resultados encontrados",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    }
                }
            });
            tablaPersistencia.rows.add(lista);
            tablaPersistencia.draw();
        });
    </script>
<% } %>

</body>

</html>